{  
   "AWSTemplateFormatVersion":"2010-09-09",
   "Description":"BlueGreen ASG with Network LB",
   "Parameters":{  
      "TargetGroupName":{  
         "Type":"String",
         "Default":"BlueGreen",
         "Description":"Name of the target group to be created."
      },
      "InstanceCount":{  
         "Type":"Number",
         "Default":1,
         "Description":"Number of desired instances in Auto Scaling Group"
      },
      "AMI":{  
         "Type":"String",
         "Default":"ami-24d70959",
         "Description":"ID of the AMI to spawn instances from."
      }
   },
   "Resources":{  
      "targetGroup80":{  
         "Type":"AWS::ElasticLoadBalancingV2::TargetGroup",
         "Properties":{  
            "Port":80,
            "Protocol":"HTTP",
            "TargetType":"instance",
            "VpcId":"vpc-10190674"
         }
      },
      "launchConfiguration":{  
         "Type":"AWS::AutoScaling::LaunchConfiguration",
         "Properties":{  
            "IamInstanceProfile":"arn:aws:iam::234741136504:instance-profile/ec2-default-role",
            "ImageId":{  
               "Ref":"AMI"
            },
            "InstanceType":"c4.2xlarge",
            "KeyName":"CFAProd",
            "SecurityGroups":[  
               "sg-e16d5e99"
            ]
         }
      },
      "autoScalingGroup":{  
         "Type":"AWS::AutoScaling::AutoScalingGroup",
         "Properties":{  
            "AutoScalingGroupName":"BlueGreenDeployment",
            "Cooldown":"30",
            "DesiredCapacity":{  
               "Ref":"InstanceCount"
            },
            "HealthCheckGracePeriod":"1500",
            "HealthCheckType":"ELB",
            "LaunchConfigurationName":{  
               "Ref":"launchConfiguration"
            },
            "MaxSize":{  
               "Ref":"InstanceCount"
            },
            "MinSize":{  
               "Ref":"InstanceCount"
            },
            "VPCZoneIdentifier":[  
               "subnet-b970e1e1",
               "subnet-f67ff6dc",
               "subnet-c6703efb"
            ],
            "TargetGroupARNs":[  
               {  
                  "Ref":"targetGroup80"
               },
               {  
                  "Ref":"targetGroup443"
               }
            ]
         }
      }
   }
}